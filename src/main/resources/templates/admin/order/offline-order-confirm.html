<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head th:replace="admin/fragments/head :: head"></head>

<body>
	<div class="wrapper">
		<!-- Sidebar -->
		<div th:replace="admin/fragments/sidebar :: sidebar"></div>

		<div class="main-panel">
			<!-- Header -->
			<div th:replace="~{admin/fragments/header :: header}"></div>

			<div class="container" style="background-color: #faeee7; border-radius: 0px;">
				<div class="page-inner">
					<h3 class="mb-4 text-center">X√°c nh·∫≠n s·∫£n ph·∫©m ƒë√£ ch·ªçn</h3>

					<!-- üî• Hi·ªÉn th·ªã th√¥ng b√°o -->
					<div class="text-center">
						<div th:if="${successMessage}" class="alert alert-success">
							<span th:text="${successMessage}"></span>
						</div>
						<div th:if="${errorMessage}" class="alert alert-danger">
							<span th:text="${errorMessage}"></span>
						</div>
						<div th:if="${orderItems == null or #lists.isEmpty(orderItems)}" class="alert alert-warning">
							Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o trong ƒë∆°n h√†ng.
						</div>
					</div>

					<!-- üî• Danh s√°ch s·∫£n ph·∫©m ƒë√£ ch·ªçn -->
					<div class="mb-4">
						<table class="table table-bordered text-center align-middle"
							th:if="${orderItems != null and not #lists.isEmpty(orderItems)}">
							<thead class="table-light">
								<tr>
									<th>H√¨nh ·∫£nh</th>
									<th>S·∫£n ph·∫©m</th>
									<th>Gi√°</th>
									<th>S·ªë l∆∞·ª£ng</th>
									<th>H√†nh ƒë·ªông</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="item : ${orderItems}">
									<td>
										<img th:src="@{/upload/} + ${item.sanPham.hinhAnh}" style="width: 80px;">
									</td>
									<td th:text="${item.sanPham.tenSanPham}"></td>
									<td th:text="${formattedDiscountPrices[item.sanPham.maSanPham]}"></td>
									<td th:text="${item.soLuong}"></td>
									<td>
										<form th:action="@{/admin/offline-orders/remove}" method="post">
											<input type="hidden" name="sanPhamId" th:value="${item.sanPham.maSanPham}">
											<button type="submit" class="btn btn-danger btn-sm">X√≥a</button>
										</form>
									</td>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- üî• Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng -->
					<form th:action="@{/admin/offline-orders/check-phone}" method="POST"
						class="d-flex justify-content-center align-items-center mb-4">
						<label for="soDienThoai" class="me-2 fw-bold">S·ªë ƒëi·ªán tho·∫°i kh√°ch h√†ng:</label>
						<input type="text" id="soDienThoai" name="soDienThoai" class="form-control me-2"
							placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i (b·ªè tr·ªëng n·∫øu l√† kh√°ch v√£ng lai)"
							th:value="${soDienThoai != '0000000000' ? soDienThoai : ''}" style="max-width: 250px;">

						<button type="submit" class="btn btn-primary">Ki·ªÉm tra</button>
					</form>
					<!-- üî• Ch·ªâ hi·ªÉn th·ªã n·∫øu ƒë√£ ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i -->
					<div class="text-center" th:if="${tenKhachHang != null}">
						<span class="fw-bold"
							th:classappend="${tenKhachHang == 'Kh√°ch v√£ng lai'} ? 'text-danger' : 'text-success'">
							Kh√°ch h√†ng: <span th:text="${tenKhachHang}"></span>
						</span>
					</div>



					<!-- üî• T·ªïng ti·ªÅn v√† n√∫t h√†nh ƒë·ªông -->
					<div class="text-center mb-4">
						<h4 style="color: #007bff;">T·ªïng ti·ªÅn: <span th:text="${totalPrice} + ' VND'"></span></h4>
					</div>

					<!-- üî• N√∫t "X√°c nh·∫≠n ƒë∆°n h√†ng" & "Quay l·∫°i" -->
					<div class="d-flex justify-content-center">
						<form id="orderForm" th:action="@{/admin/offline-orders/checkout}" method="POST" class="me-2">
							<input type="hidden" id="soDienThoaiHiddenForm" name="soDienThoai"
								th:value="${soDienThoai}">
							<button type="submit" class="btn btn-success">X√°c nh·∫≠n ƒë∆°n h√†ng</button>
						</form>
						<a href="/admin/offline-orders" class="btn btn-secondary">Quay l·∫°i</a>
					</div>

				</div>
			</div>

			<!-- Footer -->
			<div th:replace="admin/fragments/footer :: footer"></div>
		</div>
	</div>

	<div th:replace="admin/fragments/script :: script"></div>
</body>

</html>