<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head th:replace="admin/fragments/head :: head"></head>

<body>
	<div class="wrapper">
		<!-- Sidebar -->
		<div th:replace="admin/fragments/sidebar :: sidebar"></div>

		<div class="main-panel">
			<!-- Header -->
			<div th:replace="~{admin/fragments/header :: header}"></div>

			<div class="container" style="background-color: #fafcff; border-radius: 0px;">
				<div class="page-inner">
					<h3 class="mb-4">T·∫°o ƒê∆°n H√†ng Tr·ª±c Ti·∫øp</h3>

					<!-- üî• Thanh t√¨m ki·∫øm s·∫£n ph·∫©m 
					<form th:action="@{/admin/offline-orders}" method="get" class="d-flex mb-3">
						<input type="text" name="keyword" th:value="${keyword}" placeholder="T√¨m s·∫£n ph·∫©m..."
							class="form-control me-2" style="max-width: 300px;">
						<button type="submit" class="btn btn-primary">
							<i class="fa fa-search"></i> T√¨m ki·∫øm
						</button>

					
						<input type="hidden" name="selectedProductIds"
							th:value="${#strings.listJoin(selectedProductIds, ',')}">
						<input type="hidden" name="selectedQuantities"
							th:value="${#strings.listJoin(selectedQuantities, ',')}">
					</form>-->


					<!-- üî• Ch·ªçn s·∫£n ph·∫©m tr∆∞·ªõc -->
					<div class="mb-3">

						<table class="table table-bordered">
							<thead>
								<tr>
									<th style="text-align: center">M√£ SP</th>
									<th style="text-align: center">H√¨nh ·∫£nh</th>
									<th style="width: 25%;">S·∫£n ph·∫©m</th>
									<th style="text-align: center">Gi√°</th>
									<th style="width: 15%; text-align: center;">S·ªë l∆∞·ª£ng c√≤n l·∫°i</th>
									<th style="text-align: center">S·ªë l∆∞·ª£ng</th>

								</tr>
							</thead>
							<tbody>
								<tr th:each="sp : ${sanPhamList}">
									<td style="text-align: center" th:text="${sp.maSanPham}"></td>
									<td style="text-align: center"><img th:src="@{/upload/} + ${sp.hinhAnh}"
											style="width: 80px;"></td>
									<td th:text="${sp.tenSanPham}"></td>
									<td style="text-align: center">
										<span
											th:utext="${formattedDiscountPrices != null and formattedDiscountPrices.containsKey(sp.maSanPham) ? formattedDiscountPrices[sp.maSanPham] : 'Kh√¥ng c√≥ gi√°'}"></span>
									</td>
									<td style="text-align: center" th:text="${sp.soLuong}"></td>
									<td style="text-align: center">
										<form th:action="@{/admin/offline-orders/add}" method="post">
											<input type="hidden" name="sanPhamId" th:value="${sp.maSanPham}">
											<input type="number" class="form-control" name="soLuong" value="1" min="1"
												th:attr="max=${sp.soLuong}">
											<button type="submit" class="btn btn-primary mt-2">Th√™m</button>
										</form>
									</td>
								</tr>
							</tbody>
						</table>

					</div>


					<!-- üü¢ Gi·ªØ danh s√°ch ƒë√£ ch·ªçn -->
					<input type="hidden" name="selectedProductIds"
						th:value="${selectedProductIds != null ? #strings.listJoin(selectedProductIds, ',') : ''}">
					<input type="hidden" name="selectedQuantities"
						th:value="${selectedQuantities != null ? #strings.listJoin(selectedQuantities, ',') : ''}">

					<div class="text-center mt-3">
						<a href="/admin/offline-orders/confirm" class="btn btn-success">X√°c Nh·∫≠n</a>
					</div>


					<!-- ‚úÖ Thanh ph√¢n trang -->
					<nav aria-label="Page navigation">
						<ul class="pagination justify-content-center">
							<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
								<a class="page-link"
									th:href="@{/admin/offline-orders(page=0, keyword=${keyword}, selectedProductIds=${selectedProductIds != null ? #strings.listJoin(selectedProductIds, ',') : ''}, selectedQuantities=${selectedQuantities != null ? #strings.listJoin(selectedQuantities, ',') : ''})}">
									ƒê·∫ßu
								</a>
							</li>
							<li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
								<a class="page-link"
									th:href="@{/admin/offline-orders(page=${currentPage > 0 ? currentPage - 1 : 0}, keyword=${keyword}, selectedProductIds=${selectedProductIds != null ? #strings.listJoin(selectedProductIds, ',') : ''}, selectedQuantities=${selectedQuantities != null ? #strings.listJoin(selectedQuantities, ',') : ''})}">
									‚Äπ
								</a>
							</li>
							<li class="page-item"
								th:each="i : ${#numbers.sequence(0, totalPages > 0 ? totalPages - 1 : 0)}"
								th:classappend="${currentPage == i} ? 'active'">
								<a class="page-link"
									th:href="@{/admin/offline-orders(page=${i}, keyword=${keyword}, selectedProductIds=${selectedProductIds != null ? #strings.listJoin(selectedProductIds, ',') : ''}, selectedQuantities=${selectedQuantities != null ? #strings.listJoin(selectedQuantities, ',') : ''})}"
									th:text="${i + 1}"></a>
							</li>
							<li class="page-item"
								th:classappend="${currentPage == totalPages - 1 or totalPages == 0} ? 'disabled'">
								<a class="page-link"
									th:href="@{/admin/offline-orders(page=${currentPage < totalPages - 1 ? currentPage + 1 : totalPages - 1}, keyword=${keyword}, selectedProductIds=${selectedProductIds != null ? #strings.listJoin(selectedProductIds, ',') : ''}, selectedQuantities=${selectedQuantities != null ? #strings.listJoin(selectedQuantities, ',') : ''})}">
									‚Ä∫
								</a>
							</li>
							<li class="page-item"
								th:classappend="${currentPage == totalPages - 1 or totalPages == 0} ? 'disabled'">
								<a class="page-link"
									th:href="@{/admin/offline-orders(page=${totalPages > 0 ? totalPages - 1 : 0}, keyword=${keyword}, selectedProductIds=${selectedProductIds != null ? #strings.listJoin(selectedProductIds, ',') : ''}, selectedQuantities=${selectedQuantities != null ? #strings.listJoin(selectedQuantities, ',') : ''})}">
									Cu·ªëi
								</a>
							</li>
						</ul>
					</nav>
				</div>
			</div>


			<!-- Footer -->
			<div th:replace="admin/fragments/footer :: footer"></div>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<script th:inline="javascript">
		/*<![CDATA[*/
		const successMessage = /*[[${successMessage != null}]]*/ false;
		const errorMessage = /*[[${errorMessage != null}]]*/ false;

		if (successMessage) {
			Swal.fire({
				title: 'üéâ Th√†nh c√¥ng!',
				text: '[[${successMessage}]]',
				icon: 'success',
				timer: 1500,
				showConfirmButton: false,
				timerProgressBar: true
			});
		}

		if (errorMessage) {
			Swal.fire({
				title: '‚ùå L·ªói',
				text: '[[${errorMessage}]]',
				icon: 'error',
				timer: 500,
				showConfirmButton: false,
				timerProgressBar: true
			});
		}
		/*]]>*/
	</script>


	<div th:replace="admin/fragments/script :: script"></div>
</body>

</html>