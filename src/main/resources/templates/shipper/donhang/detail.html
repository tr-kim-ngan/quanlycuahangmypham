<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{shipper/fragments/head::head}">
	<title>Chi ti·∫øt ƒë∆°n h√†ng</title>
</head>

<body>
	<div class="wrapper">
		<div class="sidebar" th:replace="~{shipper/fragments/sidebar::sidebar}"></div>
		<div class="main-panel">
			<div th:replace="~{shipper/fragments/header::header}"></div>

			<div class="container mt-4"
				style="padding-left:190px; padding-right:0; margin-right: 0px; margin-left: 100px;">
				<div class="p-4"
					style="background: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
					<h3 class="text-center text-primary">Chi ti·∫øt ƒë∆°n h√†ng</h3>
					<hr>
					<div class="row">
						<div class="col-md-6" style="padding-left:100px;">
							<p><strong>M√£ ƒë∆°n h√†ng:</strong> <span th:text="${order.maDonHang}"></span></p>
							<p th:if="${order.nguoiDung != null}">
								<strong>Ng∆∞·ªùi ƒë·∫∑t h√†ng:</strong> <span th:text="${order.nguoiDung.tenNguoiDung}"></span>
							</p>
							<p th:if="${order.nguoiDung == null}" class="text-danger">
								<strong>Ng∆∞·ªùi ƒë·∫∑t h√†ng:</strong> Kh√¥ng c√≥ th√¥ng tin
							</p>
							<p><strong>S·ªë ƒëi·ªán tho·∫°i nh·∫≠n h√†ng:</strong> <span th:text="${order.sdtNhanHang}"></span>
							</p>
							<p><strong>Ng√†y ƒë·∫∑t:</strong> <span
									th:text="${#temporals.format(order.ngayDat, 'dd/MM/yyyy HH:mm')}"></span></p>
						</div>
						<div class="col-md-6">
							<p><strong>ƒê·ªãa ch·ªâ giao h√†ng:</strong> <span th:text="${order.diaChiGiaoHang}"></span></p>
							<p><strong>Tr·∫°ng th√°i:</strong> <span class="badge bg-info"
									th:text="${order.trangThaiDonHang}"></span></p>
							<p><strong>Ghi ch√∫:</strong> <span th:text="${order.ghiChu}"></span></p>
							<p><strong>Ph√≠ v·∫≠n chuy·ªÉn:</strong>
								<span
									th:text="${#numbers.formatDecimal(order.phiVanChuyen, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></span>
							</p>
							<p><strong>T·ªïng gi√° tr·ªã ƒë∆°n h√†ng:</strong>
								<span class="text-danger fw-bold"
									th:text="${#numbers.formatDecimal(order.tongGiaTriDonHang, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></span>
							</p>
						</div>
					</div>

					<p th:if="${order.trangThaiChoXacNhan != null}" class="text-warning" style="padding-left:100px;">
						<strong>Tr·∫°ng th√°i ch·ªù x√°c nh·∫≠n:</strong> <span th:text="${order.trangThaiChoXacNhan}"></span>
					</p>

					<hr>
					<h5 class="mt-3" style="padding-left:100px;">Danh s√°ch s·∫£n ph·∫©m</h5>
					<ul class="p-0" th:each="item : ${order.chiTietDonHangs}" style="list-style: none;">
						<li class="py-2 d-flex align-items-center justify-content-between" style="padding-left:100px;">
							<div class="col-md-6">
								<strong
									th:text="${item.sanPham != null ? item.sanPham.tenSanPham : 'Kh√¥ng c√≥ d·ªØ li·ªáu'}"></strong>
								<p>S·ªë l∆∞·ª£ng: <span th:text="${item.soLuong}"></span></p>
								<p>Gi√°: <span
										th:text="${#numbers.formatDecimal(item.giaTaiThoiDiemDat, 0, 'COMMA', 2, 'POINT')} + ' ƒë'"></span>
								</p>
							</div>
							<div class="col-md-6">
								<img th:src="@{'/upload/' + ${item.sanPham.hinhAnh}}" alt="H√¨nh ·∫£nh s·∫£n ph·∫©m"
									style="width: 90px; height: 90px; object-fit: cover; border-radius: 8px; box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);">
							</div>
						</li>
					</ul>

					<hr>

					<!-- N·∫øu tr·∫°ng th√°i l√† 'ƒêang chu·∫©n b·ªã h√†ng' v√† ƒë∆°n h√†ng ƒë√£ th·∫•t b·∫°i l·∫ßn 1, hi·ªÉn th·ªã n√∫t 'X√°c nh·∫≠n ƒëang giao l·∫°i (L·∫ßn 2)' -->
					<th:block
						th:if="${order.trangThaiDonHang == 'ƒêang chu·∫©n b·ªã h√†ng' and order.trangThaiChoXacNhan == 'Giao h√†ng th·∫•t b·∫°i (L·∫ßn 1)'}">
						<form th:action="@{/shipper/order/update-status}" method="post" style="padding-left:100px;">
							<input type="hidden" name="orderId" th:value="${order.maDonHang}">
							<input type="hidden" name="status" value="ƒêang giao h√†ng">
							<button type="submit" class="btn btn-warning mt-3">üöö X√°c nh·∫≠n ƒëang giao l·∫°i (L·∫ßn
								2)</button>
						</form>
					</th:block>
					<th:block
						th:if="${order.trangThaiDonHang == 'ƒêang chu·∫©n b·ªã h√†ng' and order.trangThaiChoXacNhan == null}">

						<form th:action="@{/shipper/order/update-status}" method="post" style="padding-left:100px;">
							<input type="hidden" name="orderId" th:value="${order.maDonHang}">
							<input type="hidden" name="status" value="ƒêang giao h√†ng">
							<button type="submit" class="btn btn-warning mt-3">üöö X√°c nh·∫≠n b·∫Øt ƒë·∫ßu giao h√†ng</button>
						</form>
					</th:block>
					<!-- N·∫øu tr·∫°ng th√°i l√† 'Ch·ªù shipper x√°c nh·∫≠n l·∫°i', shipper s·∫Ω th·∫•y n√∫t x√°c nh·∫≠n -->
					<th:block th:if="${order.trangThaiChoXacNhan == 'Ch·ªù shipper x√°c nh·∫≠n l·∫°i'}">
						<form th:action="@{/shipper/order/confirm-shipper}" method="post" style="padding-left:100px;">
							<input type="hidden" name="orderId" th:value="${order.maDonHang}">
							<button type="submit" class="btn btn-success mt-3">‚úÖ X√°c nh·∫≠n nh·∫≠n ƒë∆°n</button>
						</form>
					</th:block>


					<!-- N·∫øu tr·∫°ng th√°i l√† 'ƒêang giao h√†ng' th√¨ hi·ªÉn th·ªã dropdown ch·ªçn k·∫øt qu·∫£ giao -->
					<th:block
						th:if="${order.trangThaiDonHang == 'ƒêang giao h√†ng' and order.trangThaiChoXacNhan == null}">
						<h5 class="mt-3" style="padding-left:100px;">C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng</h5>
						<form th:action="@{/shipper/order/update-status}" method="post" style="padding-left:100px;"
							enctype="multipart/form-data">
							<input type="hidden" name="orderId" th:value="${order.maDonHang}">
							<label for="status">Tr·∫°ng th√°i:</label>
							<select name="status" id="status" class="form-select" onchange="toggleInputFields()">
								<option value="ƒê√£ ho√†n th√†nh">ƒê√£ ho√†n th√†nh</option>
								<option value="Giao th·∫•t b·∫°i">Giao th·∫•t b·∫°i</option>
							</select>

							<div id="lyDoGiaoThatBai" style="display: none; margin-top: 10px;">
								<label for="lyDo">L√Ω do giao th·∫•t b·∫°i:</label>
								<textarea name="lyDo" id="lyDo" class="form-control" rows="3"></textarea>
							</div>

							<div id="hinhAnhDiv" style="margin-top: 10px;">
								<label for="hinhAnh">H√¨nh ·∫£nh ch·ª©ng minh giao h√†ng (t·ªëi ƒëa 2MB):</label>
								<input type="file" name="hinhAnh" id="hinhAnh" class="form-control" accept="image/*">
							</div>

							<button type="submit" class="btn btn-primary mt-3">G·ª≠i c·∫≠p nh·∫≠t</button>
						</form>
					</th:block>

					<script>
						function toggleInputFields() {
							var status = document.getElementById("status").value;
							var lyDoDiv = document.getElementById("lyDoGiaoThatBai");
							var hinhAnhDiv = document.getElementById("hinhAnhDiv");
							var hinhAnhInput = document.getElementById("hinhAnh");

							if (status === "Giao th·∫•t b·∫°i") {
								lyDoDiv.style.display = "block";  // Hi·ªán √¥ nh·∫≠p l√Ω do th·∫•t b·∫°i
								hinhAnhDiv.style.display = "none"; // ·∫®n √¥ nh·∫≠p ·∫£nh
								hinhAnhInput.value = ""; // X√≥a gi√° tr·ªã ·∫£nh ƒë√£ ch·ªçn (n·∫øu c√≥)
							} else {
								lyDoDiv.style.display = "none";
								hinhAnhDiv.style.display = "block"; // Hi·ªán √¥ nh·∫≠p ·∫£nh n·∫øu ch·ªçn "ƒê√£ ho√†n th√†nh"
							}
						}

						document.addEventListener("DOMContentLoaded", function () {
							toggleInputFields(); // ƒê·∫£m b·∫£o ch·∫°y khi trang t·∫£i
							document.getElementById("status").addEventListener("change", toggleInputFields);
						});
					</script>

				</div>
			</div>
		</div>
	</div>
</body>

</html>