<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Th·ªëng k√™ Xu·∫•t Kho</title>
	<link rel="icon" type="image/png" th:href="@{/fe/images/export.png}">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<style>
		/* ƒê·ªãnh d·∫°ng t·ªïng th·ªÉ */
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
		}

		/* Sidebar */
		.sidebar {
			width: 250px;
			min-height: 100px;
			/* ƒê·∫£m b·∫£o kh√¥ng b·ªã co qu√° nh·ªè */
			max-height: 90vh;
			/* Gi·ªõi h·∫°n chi·ªÅu cao t·ªëi ƒëa */
			position: fixed;
			top: 53px;
			right: -250px;
			/* ·∫®n sidebar ban ƒë·∫ßu */
			background-color: white;
			color: black;
			padding: 5px 5px 0px 0px;
			overflow-y: auto;
			/* Cu·ªôn n·∫øu n·ªôi dung qu√° d√†i */
			transition: right 0.3s ease-in-out;
			box-shadow: -3px 0 5px rgba(0, 0, 0, 0.2);
			border-radius: 10px;
			/* Bo g√≥c nh√¨n g·ªçn h∆°n */
		}

		/* Khi m·ªü */
		.sidebar.open {
			right: 0;
			top: 53px;
		}

		/* CƒÉn ch·ªânh l·∫°i kho·∫£ng c√°ch gi·ªØa c√°c m·ª•c */
		.sidebar ul {
			list-style: none;
			padding: 0;
			margin: 0;
		}

		.sidebar ul li {
			padding: 10px 20px;
			transition: background 0.3s;
		}

		/* Link */
		.sidebar ul li a {
			text-decoration: none;
			color: black;
			display: flex;
			align-items: center;
			gap: 8px;
			/* Kho·∫£ng c√°ch gi·ªØa icon v√† text */
		}

		.sidebar ul li:hover {
			background-color: #dee2e6;
		}


		/* Container ch√≠nh */


		/* Ti√™u ƒë·ªÅ */
		.header {
			background-color: #f8f9fa;
			padding: 15px;
			text-align: center;
			font-size: 18px;
			font-weight: bold;
			border-bottom: 2px solid #dee2e6;
		}

		/* Form ch·ªçn ng√†y */
		.filter-form {
			display: flex;
			justify-content: center;
			align-items: center;
			margin-bottom: 15px;
		}

		.filter-form input {
			padding: 8px;
			margin: 5px;
			border: 1px solid #ccc;
			border-radius: 5px;
		}

		.filter-form button {
			background-color: #007bff;
			color: white;
			border: none;
			padding: 8px 12px;
			border-radius: 5px;
			cursor: pointer;
			margin-left: 5px;
		}

		.filter-form button:hover {
			background-color: #0056b3;
		}

		/* Bi·ªÉu ƒë·ªì */
		.chart-container {
			width: 100%;
			/* Chi·∫øm kho·∫£ng 90% kh√¥ng gian thay v√¨ 100% */
			max-width: 100%;
			/* Gi·ªõi h·∫°n k√≠ch th∆∞·ªõc t·ªëi ƒëa ƒë·ªÉ tr√°nh b·ªã qu√° r·ªông */
			margin-left: 50px;
			padding: 10px;
		}


		.container {
			width: calc(100% - 280px);
			/* 100% tr·ª´ ƒëi chi·ªÅu r·ªông navbar */
			margin-left: 250px;
			/* D·ªãch ph·∫£i ƒë·ªÉ tr√°nh b·ªã che b·ªüi navbar */
			padding: 20px;
			background: white;
			max-width: 1300px;
			/* Gi·ªõi h·∫°n chi·ªÅu r·ªông t·ªëi ƒëa */
		}


		.toggle-btn {
			position: fixed;
			top: 0;
			right: 20px;
			background: transparent;
			color: black;
			border: none;
			padding: 10px 15px;
			cursor: pointer;
			font-size: 16px;

			transition: background 0.3s;
			right: 20px;
		}

		canvas {
			width: 100% !important;
			height: 450px !important;
			max-width: 1000px;
			/* ƒê·ªãnh gi·ªõi h·∫°n chi·ªÅu r·ªông */
		}

		.report-container {
			margin-top: 20px;
			padding: 20px;
			background: white;
			border-radius: 8px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
		}

		.report-container h3 {
			margin-bottom: 15px;
			font-size: 18px;
			font-weight: bold;
		}

		table {
			width: 100%;
			border-collapse: collapse;
			background: white;
		}

		th,
		td {
			padding: 10px;
			text-align: center;
			border: 1px solid #ddd;
		}

		th {
			background-color: #f8f9fa;
			font-weight: bold;
		}

		tr:nth-child(even) {
			background-color: #f2f2f2;
		}

		tr:hover {
			background-color: #e6f7ff;
		}

		/* Ki·ªÉu d√°ng chung cho th√¥ng b√°o l·ªói */
		#errorMessage {
			display: none;
			/* ·∫®n m·∫∑c ƒë·ªãnh */
			background-color: #f8d7da;
			/* M√†u n·ªÅn ƒë·ªè nh·∫°t */
			color: #721c24;
			/* M√†u ch·ªØ ƒë·ªè ƒë·∫≠m */
			border: 1px solid #f5c6cb;
			/* Vi·ªÅn ƒë·ªè nh·∫°t */
			padding: 12px 16px;
			/* Padding ƒë·ªÉ d·ªÖ nh√¨n */
			border-radius: 8px;
			/* Bo tr√≤n g√≥c */
			font-size: 16px;
			/* K√≠ch th∆∞·ªõc ch·ªØ */
			font-weight: bold;
			/* Ch·ªØ ƒë·∫≠m */
			width: fit-content;
			/* Gi·ªØ ƒë·ªô r·ªông v·ª´a ƒë·ªß n·ªôi dung */
			max-width: 100%;
			/* Kh√¥ng b·ªã tr√†n m√†n h√¨nh */
			box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
			/* Hi·ªáu ·ª©ng b√≥ng */


		}
	</style>
</head>

<body>

	<button class="toggle-btn" onclick="toggleSidebar()">‚ò∞ Th·ªëng k√™</button>

	<!-- Sidebar b√™n ph·∫£i -->
	<div class="sidebar" id="sidebar">
		<ul>
			<li><a th:href="@{/warehouse/import/thong-ke}" th:classappend="${activeMenu == 'tong-quan'} ? 'active'">
					Nh·∫≠p theo s·∫£n ph·∫©m
				</a></li>
			<li><a th:href="@{/warehouse/import/thong-ke/tong-gia-tri}"
					th:classappend="${activeMenu == 'tong-gia-tri'} ? 'active'">T·ªïng gi√° tr·ªã nh·∫≠p kho</a></li>
			<li><a th:href="@{/warehouse/import/thong-ke/xu-huong}"
					th:classappend="${activeMenu == 'xu-huong'} ? 'active'">Xu h∆∞·ªõng nh·∫≠p kho</a></li>
			<li>
				<a th:href="@{/warehouse/import/thong-ke-xuat}" th:classappend="${activeMenu == 'xuat-kho'} ? 'active'">
					Th·ªëng k√™ xu·∫•t kho
				</a>
			</li>

		</ul>
	</div>
	<div class="header">Th·ªëng k√™ xu·∫•t kho</div>

	<div th:replace="/warehouse/import/fragments/navbar :: navbar"></div>

	<div class="container">
		<div id="errorMessage" class="alert alert-danger" style="display: none;">
			<strong>L·ªói:</strong> <span id="errorText"></span>
		</div>
		<form method="GET" action="/warehouse/import/thong-ke-xuat" class="filter-form"
			onsubmit="return validateDateFilter()">
			<label>T·ª´ ng√†y:</label>
			<input type="date" id="fromDate" name="fromDate" th:value="${fromDate}" required>
			<label>ƒê·∫øn ng√†y:</label>
			<input type="date" id="toDate" name="toDate" th:value="${toDate}" required>
			<button type="submit">L·ªçc</button>
		</form>
		<div class="chart-container">
			<canvas id="exportChart"></canvas>
		</div>
		<div class="chart-container">
			<h3>üìä S·ªë L∆∞·ª£ng T·ªìn Kho</h3>
			<canvas id="stockChart"></canvas>
		</div>

		<div class="report-container">
			<h3>üìã B√°o c√°o chi ti·∫øt xu·∫•t kho</h3>
			<table>
				<thead>
					<tr>
						<th>S·∫£n ph·∫©m</th>
						<th>S·ªë l∆∞·ª£ng xu·∫•t</th>
						<th>Ng√†y xu·∫•t</th>
						<th>Kh√°ch h√†ng</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="row : ${danhSachBaoCao}">
						<td th:text="${row[0]}"></td>
						<td th:text="${row[1]}" style="text-align: center;"></td>
						<td th:text="${#temporals.format(row[2], 'dd/MM/yyyy')}"></td>
						<td th:text="${row[3]}" style="white-space: nowrap;"></td>
					</tr>
				</tbody>
			</table>
		</div>

		<div class="report-container">
			<h3>üìå Top S·∫£n Ph·∫©m Xu·∫•t Nhi·ªÅu Nh·∫•t</h3>
			<table>
				<thead>
					<tr>
						<th>STT</th>
						<th>S·∫£n Ph·∫©m</th>
						<th>T·ªïng S·ªë L∆∞·ª£ng Xu·∫•t</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="product, iterStat : ${topProducts}">
						<td th:text="${iterStat.count}"></td>
						<td th:text="${product[0]}"></td>
						<td th:text="${product[1]}"></td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>

	<script th:inline="javascript">
		var labels = /*[[${labels}]]*/[];
		var values = /*[[${values}]]*/[];

		var stockLabels = /*[[${stockLabels}]]*/[];
		var stockValuesBefore = /*[[${stockValuesBefore}]]*/[];
		var stockValuesAfter = /*[[${stockValuesAfter}]]*/[];

		var ctx = document.getElementById('exportChart').getContext('2d');
		new Chart(ctx, {
			type: 'bar',
			data: {
				labels: labels,
				datasets: [{
					label: 'S·ªë l∆∞·ª£ng xu·∫•t',
					data: values,
					backgroundColor: 'rgba(255, 99, 132, 0.6)',
					borderColor: 'rgba(255, 99, 132, 1)',
					borderWidth: 1
				}]
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				scales: {
					y: {
						beginAtZero: true
					}
				}
			}
		});
		var ctxStock = document.getElementById('stockChart').getContext('2d');
		new Chart(ctxStock, {
			type: 'bar',
			data: {
				labels: stockLabels,
				datasets: [{
					label: 'T·ªìn kho tr∆∞·ªõc ki·ªÉm k√™',
					data: stockValuesBefore,
					backgroundColor: 'rgba(54, 162, 235, 0.6)',
					borderColor: 'rgba(54, 162, 235, 1)',
					borderWidth: 1
				}, {
					label: 'T·ªìn kho sau ki·ªÉm k√™',
					data: stockValuesAfter,
					backgroundColor: 'rgba(255, 99, 132, 0.6)',
					borderColor: 'rgba(255, 99, 132, 1)',
					borderWidth: 1
				}]
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				scales: {
					y: {
						beginAtZero: true
					}
				}
			}
		});
		function toggleSidebar() {
			var sidebar = document.getElementById("sidebar");
			var mainContent = document.getElementById("mainContent");

			if (sidebar.classList.contains("open")) {
				sidebar.classList.remove("open");
				mainContent.classList.remove("shifted");
			} else {
				sidebar.classList.add("open");
				mainContent.classList.add("shifted");
			}
		}
		function validateDateFilter() {
			var fromDate = document.getElementById("fromDate").value;
			var toDate = document.getElementById("toDate").value;
			var today = new Date().toISOString().split("T")[0];
			var errorMessage = document.getElementById("errorMessage");
			var errorText = document.getElementById("errorText");

			errorMessage.style.display = "none";

			if (!fromDate || !toDate) {
				errorText.innerText = "Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c.";
				errorMessage.style.display = "block";
				return false;
			}

			if (fromDate > toDate) {
				errorText.innerText = "Ng√†y b·∫Øt ƒë·∫ßu kh√¥ng ƒë∆∞·ª£c l·ªõn h∆°n ng√†y k·∫øt th√∫c.";
				errorMessage.style.display = "block";
				return false;
			}

			if (toDate > today || fromDate > today) {
				errorText.innerText = "Kh√¥ng th·ªÉ ch·ªçn ng√†y trong t∆∞∆°ng lai.";
				errorMessage.style.display = "block";
				return false;
			}

			return true;
		}

	</script>

</body>

</html>