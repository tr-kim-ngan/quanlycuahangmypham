<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Chi ti·∫øt ƒë∆°n h√†ng</title>
	<link rel="icon" type="image/png" th:href="@{/fe/images/warehouse.png}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 0;
			padding: 0;
		}

		.container {
			max-width: 1100px;
			margin: 0px auto 20px;
			padding-top: 20px;
			background: white;
			border-radius: 8px;
		}

		h2 {
			text-align: center;
			color: #333;
			margin-bottom: 20px;
		}

		.btn {
			padding: 10px 15px;
			font-size: 16px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			text-decoration: none;
			text-align: center;
		}

		.btn-group {
			display: flex;
			justify-content: flex-end;
			/* ƒê·∫©y n√∫t v·ªÅ b√™n ph·∫£i */
			gap: 10px;
			/* Kho·∫£ng c√°ch gi·ªØa hai n√∫t */
			margin-top: 10px;
			/* T·∫°o kho·∫£ng c√°ch v·ªõi n·ªôi dung ph√≠a tr√™n */
		}

		.btn-success {
			background-color: #28a745;
			color: white;
			border: none;
			display: block;

			text-align: center;
		}

		.btn-secondary {
			background-color: #007bff;
			color: white;
		}

		.header {
			background-color: #f8f9fa;
			padding: 10px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			border-bottom: 2px solid #dee2e6;
		}

		.header-buttons {
			display: flex;
			gap: 10px;
			margin-right: 20px;
		}

		.header h2 {
			margin: 0;
			font-size: 20px;
			color: #333;
		}

		table {
			width: 100%;
			border-collapse: collapse;
		}

		th,
		td {
			padding: 12px;
			text-align: center;
			border: 1px solid #dee2e6;
		}

		th {
			background-color: azure;
			color: black;
			text-transform: uppercase;
		}

		tr:nth-child(even) {
			background-color: #f9f9f9;
		}

		tr:hover {
			background-color: #f1f1f1;
		}

		.action a {
			text-decoration: none;
			font-weight: bold;
			padding: 5px 10px;
			transition: 0.3s;
		}
	</style>
</head>

<body>
	<div th:replace="/warehouse/import/fragments/navbar :: navbar"></div>
	<div class="header" style="padding-left: 300px;">
		<h2>Chi ti·∫øt ƒë∆°n h√†ng</h2>

		<!-- Wrapper ƒë·ªÉ cƒÉn 2 n√∫t b√™n ph·∫£i -->
		<div class="btn-group">
			<div th:if="${donHang.trangThaiDonHang == 'ƒêang x·ª≠ l√Ω'}"
				style="display: flex; align-items: center; gap: 20px;">
				<form th:action="@{/warehouse/import/confirm-export/{id}(id=${donHang.maDonHang})}" method="post"
					onsubmit="return confirm('X√°c nh·∫≠n xu·∫•t kho cho ƒë∆°n h√†ng n√†y?')">
					<button type="submit" class="btn btn-success"> <i class="fas fa-check-circle"></i> X√°c nh·∫≠n xu·∫•t
						kho</button>
				</form>
				<form th:action="@{/warehouse/import/cancel-order/{id}(id=${donHang.maDonHang})}" method="post"
					onsubmit="return validateCancelReason();"
					style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">

					<label for="cancelReason" style="font-weight: bold;">L√Ω do h·ªßy:</label>

					<select name="cancelReason" id="cancelReason"
						style="padding: 6px 10px; font-size: 14px; border-radius: 5px; min-width: 200px;">
						<option value="">-- Ch·ªçn l√Ω do --</option>
						<option value="Kh√°ch y√™u c·∫ßu h·ªßy">Kh√°ch y√™u c·∫ßu h·ªßy</option>
						<option value="H·∫øt h√†ng">H·∫øt h√†ng</option>
						<option value="L·ªói h·ªá th·ªëng">L·ªói h·ªá th·ªëng</option>
						<option value="Kh√°c">Kh√°c</option>
					</select>

					<!-- √î nh·∫≠p l√Ω do t√πy ch·ªânh -->
					<input type="text" name="customCancelReason" id="customCancelReason"
						placeholder="Nh·∫≠p l√Ω do kh√°c..."
						style="display: none; padding: 6px 10px; border-radius: 5px; min-width: 200px;">

					<button type="submit" class="btn btn-danger"
						style="padding: 8px 16px; font-size: 14px; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">
						<i class="fas fa-times-circle"></i> H·ªßy ƒë∆°n
					</button>

				</form>
			</div>
			<!-- Ch·ªâ hi·ªÉn th·ªã khi tr·∫°ng th√°i l√† 'ƒê√£ x√°c nh·∫≠n' -->
			<!-- Ch·ªâ hi·ªÉn th·ªã khi tr·∫°ng th√°i l√† 'ƒê√£ x√°c nh·∫≠n' -->
			<div th:if="${donHang.trangThaiDonHang == 'ƒê√£ x√°c nh·∫≠n'}" style="margin-top: 0px; padding-left: 300px;">
				<form th:action="@{/warehouse/import/assign-shipper/{id}(id=${donHang.maDonHang})}" method="post"
					style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">

					<label style="font-weight: bold; font-size: 16px;" for="shipper">üöö G√°n shipper:</label>

					<select name="shipperId" id="shipper" required
						style="padding: 6px 10px; font-size: 14px; border-radius: 5px; min-width: 200px; max-width: 250px;">
						<option value="">-- Ch·ªçn shipper --</option>
						<option th:each="shipper : ${danhSachShipper}" th:value="${shipper.maNguoiDung}"
							th:text="${shipper.hoTen}">
						</option>
					</select>

					<button type="submit" class="btn btn-success" style="font-size: 14px; padding: 8px 16px;">
						‚úÖ X√°c nh·∫≠n
					</button>
				</form>
			</div>

			<a href="/warehouse/import/pending-orders" class="btn btn-secondary mt-3">
				<i class="fas fa-arrow-left"></i> Quay l·∫°i
			</a>

		</div>
	</div>

	<div class="container" style="padding-left: 300px;">
		<table>
			<tr>
				<td><i class="fas fa-receipt icon"></i> M√£ ƒë∆°n h√†ng:</td>
				<td th:text="${donHang.maDonHang}"></td>
			</tr>
			<tr>
				<td><i class="fas fa-user icon"></i> Kh√°ch h√†ng:</td>
				<td
					th:text="${donHang.nguoiDung != null ? donHang.nguoiDung.hoTen + ' - ' + donHang.nguoiDung.soDienThoai : 'Kh√¥ng x√°c ƒë·ªãnh'}">
				</td>
			</tr>

			<tr>
				<td><i class="fas fa-calendar-alt icon"></i> Ng√†y ƒë·∫∑t:</td>
				<td th:text="${#temporals.format(donHang.ngayDat, 'dd-MM-yyyy HH:mm')}"></td>
			</tr>
			<tr>
				<td><i class="fas fa-info-circle icon"></i> Tr·∫°ng th√°i:</td>
				<td th:text="${donHang.trangThaiDonHang}"></td>
			</tr>

		</table>

		<h3>Danh s√°ch s·∫£n ph·∫©m</h3>
		<table>
			<thead>
				<tr>
					<th>STT</th>
					<th>H√¨nh ·∫£nh</th>
					<th>T√™n s·∫£n ph·∫©m</th>
					<th>S·ªë l∆∞·ª£ng ƒë·∫∑t</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="chiTiet, iterStat : ${donHang.chiTietDonHangs}">
					<td th:text="${iterStat.count}"></td> <!-- S·ªë th·ª© t·ª± b·∫Øt ƒë·∫ßu t·ª´ 1 -->
					<td>
						<img th:src="@{'/upload/' + ${chiTiet.sanPham.hinhAnh}}" alt="H√¨nh ·∫£nh s·∫£n ph·∫©m"
							class="product-img" style="width: 50px; height: 50px; object-fit: cover;">
					</td>
					<td th:text="${chiTiet.sanPham.tenSanPham}"></td>
					<td th:text="${chiTiet.soLuong}"></td>
				</tr>
			</tbody>
		</table>

	</div>


	<script>
		// Hi·ªán √¥ nh·∫≠p l√Ω do khi ch·ªçn "Kh√°c"
		document.addEventListener("DOMContentLoaded", function () {
			const reasonDropdown = document.getElementById("cancelReason");
			const customInput = document.getElementById("customCancelReason");

			reasonDropdown.addEventListener("change", function () {
				if (this.value === "Kh√°c") {
					customInput.style.display = "inline-block";
				} else {
					customInput.style.display = "none";
				}
			});
		});

		function validateCancelReason() {
			const reason = document.getElementById("cancelReason").value;
			const customReason = document.getElementById("customCancelReason").value;

			if (reason === "") {
				alert("Vui l√≤ng ch·ªçn l√Ω do h·ªßy ƒë∆°n h√†ng.");
				return false;
			}

			if (reason === "Kh√°c" && customReason.trim() === "") {
				alert("Vui l√≤ng nh·∫≠p l√Ω do h·ªßy ƒë∆°n h√†ng.");
				return false;
			}

			return confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n h√†ng n√†y?");
		}
	</script>
</body>


</html>