<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="customer/fragments/head :: head"></head>

<body>
	<header th:replace="customer/fragments/header :: header"></header>

	<main class="container my-4" style="max-width: 900px; margin: auto; padding-top:150px;">
		<h2 class="text-center" style="color: #333; font-weight: bold; margin-bottom: 20px;">ƒê∆°n h√†ng c·ªßa t√¥i</h2>

		<!-- Tabs tr·∫°ng th√°i ƒë∆°n h√†ng -->
		<!-- Tabs tr·∫°ng th√°i ƒë∆°n h√†ng -->
		<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
			<a th:href="@{/customer/order(type='online')}" class="tab-btn"
				th:classappend="${selectedType == 'online'} ? '' : 'inactive'" style="padding: 10px 20px; border-radius: 6px; font-weight: bold; border: 1px solid #007bff;
		text-decoration: none; transition: all 0.3s ease;
		
		">Mua online</a>

			<a th:href="@{/customer/order(type='store')}" class="tab-btn"
				th:classappend="${selectedType == 'store'} ? '' : 'inactive'" style="padding: 10px 20px; border-radius: 6px; font-weight: bold; border: 1px solid #007bff;
		text-decoration: none; transition: all 0.3s ease;
		
		">Mua t·∫°i c·ª≠a h√†ng</a>
		</div>


		<!-- Thanh menu tr·∫°ng th√°i -->
		<div class="order-tabs">
			<a th:href="@{/customer/order(status='all')}" class="order-tab"
				th:classappend="${selectedStatus == 'all'} ? 'active-tab'">
				T·∫•t c·∫£
			</a>
			<a th:href="@{/customer/order(status='M·ªõi ƒë·∫∑t')}" class="order-tab"
				th:classappend="${selectedStatus == 'M·ªõi ƒë·∫∑t'} ? 'active-tab'">
				M·ªõi ƒë·∫∑t
			</a>
			<a th:href="@{/customer/order(status='ƒêang x·ª≠ l√Ω')}" class="order-tab"
				th:classappend="${selectedStatus == 'ƒêang x·ª≠ l√Ω'} ? 'active-tab'">
				ƒêang x·ª≠ l√Ω
			</a>
			<a th:href="@{/customer/order(status='ƒê√£ x√°c nh·∫≠n')}" class="order-tab" th:classappend="${selectedStatus == 'ƒê√£ x√°c nh·∫≠n'} ? 'active-tab' 
                   ">
				ƒê√£ x√°c nh·∫≠n
			</a>

			<a th:href="@{/customer/order(status='ƒêang giao h√†ng')}" class="order-tab"
				th:classappend="${selectedStatus == 'ƒêang giao h√†ng'} ? 'active-tab'">
				ƒêang giao h√†ng
			</a>
			<a th:href="@{/customer/order(status='ƒê√£ ho√†n th√†nh')}" class="order-tab"
				th:classappend="${selectedStatus == 'ƒê√£ ho√†n th√†nh'} ? 'active-tab'">
				Th√†nh c√¥ng
			</a>
			<a th:href="@{/customer/order(status='ƒê√£ h·ªßy')}" class="order-tab"
				th:classappend="${selectedStatus == 'ƒê√£ h·ªßy'} ? 'active-tab'">
				ƒê√£ h·ªßy
			</a>
		</div>

		<!-- Danh s√°ch ƒë∆°n h√†ng -->
		<div id="order-list">
			<div th:if="${#lists.isEmpty(donHangs)}" class="no-orders">
				<img src="https://cdn-icons-png.flaticon.com/512/743/743131.png" alt="Gi·ªè h√†ng r·ªóng"
					style="width: 150px; opacity: 0.7; margin-bottom: 10px;">

				<p>B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>
				<a href="/" class="continue-shopping">Ti·∫øp t·ª•c mua s·∫Øm</a>
			</div>
			<!--
			<div th:each="order : ${donHangs}" class="order-card">
				<h5>ƒê∆°n h√†ng s·ªë: <span th:text="${order.maDonHang}"></span></h5>
				<p>Ng√†y ƒë·∫∑t: <span th:text="${#temporals.format(order.ngayDat, 'dd/MM/yyyy HH:mm')}"></span></p>
				<p>ƒê·ªãa ch·ªâ giao h√†ng: <span th:text="${order.diaChiGiaoHang}"></span></p>
				<p>Tr·∫°ng th√°i: <span th:text="${order.trangThaiDonHang}"></span></p>
				<p>Ph√≠ v·∫≠n chuy·ªÉn: <span th:text="${order.phiVanChuyen} + ' VND'"></span></p>
				<p>T·ªïng ti·ªÅn: <span th:text="${order.tongGiaTriDonHang} + ' VND'"></span></p>

				<div class="order-actions">
					<a th:href="@{/customer/order/{maDonHang}(maDonHang=${order.maDonHang})}" class="btn-view">Xem Chi
						Ti·∫øt</a>

					<form th:action="@{/customer/order/cancel}" method="POST"
						th:if="${order.trangThaiDonHang == 'ƒêang x·ª≠ l√Ω'}">
						<input type="hidden" name="maDonHang" th:value="${order.maDonHang}" />
						<button type="submit" class="btn-cancel"
							onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n h√†ng n√†y kh√¥ng?');">
							H·ªßy ƒê∆°n H√†ng
						</button>
					</form>
				</div>
			</div>
			-->



			<div th:each="order : ${donHangs}" style=" position: relative;background-color: #fff; border-radius: 10px; padding: 20px; margin-bottom: 15px; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); transition: 0.3s; border-left: 5px solid #007bff;">

				<h5 style="color: #007bff; margin-bottom: 10px;">üõí ƒê∆°n h√†ng s·ªë: <span
						th:text="${order.maDonHang}"></span></h5>

				<p><strong>üìÖ Ng√†y ƒë·∫∑t:</strong>
					<span th:text="${#temporals.format(order.ngayDat, 'dd/MM/yyyy HH:mm')}"></span>
				</p>


				<!--  Hi·ªÉn th·ªã tr·∫°ng th√°i ƒë∆°n h√†ng v·ªõi m√†u s·∫Øc n·ªïi b·∫≠t -->
				<p><strong>üìå Tr·∫°ng th√°i:</strong>
					<span th:text="${order.trangThaiDonHang}" th:style="'padding: 5px 10px; border-radius: 5px; font-weight: bold; color: white; background-color: ' + 
                (${order.trangThaiDonHang == 'M·ªõi ƒë·∫∑t'} ? '#ffcc00' : 
                (${order.trangThaiDonHang == 'ƒêang x·ª≠ l√Ω'} ? '#FFA500' : 
                (${order.trangThaiDonHang == 'ƒê√£ x√°c nh·∫≠n'} ? '#007bff' : 
                (${order.trangThaiDonHang == 'ƒêang giao h√†ng'} ? '#17a2b8' : 
                (${order.trangThaiDonHang == 'ƒê√£ ho√†n th√†nh'} ? '#28a745' : 
                (${order.trangThaiDonHang == 'ƒê√£ h·ªßy'} ? '#dc3545' : '#6c757d'))))))">
					</span>
					<!--  Hi·ªÉn th·ªã Icon tr·∫°ng th√°i -->
					<span th:switch="${order.trangThaiDonHang}">
						<span th:case="'M·ªõi ƒë·∫∑t'"></span>
						<span th:case="'ƒêang x·ª≠ l√Ω'"></span>
						<span th:case="'ƒê√£ x√°c nh·∫≠n'"></span>
						<span th:case="'ƒêang giao h√†ng'"></span>
						<span th:case="'ƒê√£ ho√†n th√†nh'"></span>
						<span th:case="'ƒê√£ h·ªßy'"></span>
						<span th:case="*"></span> <!-- Tr·∫°ng th√°i kh√¥ng x√°c ƒë·ªãnh -->
					</span>
				</p>



				<p th:if="${order.tongGiaTriDonHang != 0}">
					<strong>üí∞ T·ªïng ti·ªÅn:</strong>
					<span
						th:text="${#numbers.formatDecimal(order.tongGiaTriDonHang, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></span>
				</p>

				<p th:if="${order.tongGiaTriDonHang == 0}">
					<strong>üí∞</strong> <span style="color: green; font-weight: bold;">ƒê√£ thanh to√°n qua VNPay</span>
				</p>


				<!-- üîπ N√∫t h√†nh ƒë·ªông -->
				<div style="display: flex; gap: 10px; margin-top: 15px;">
					<!-- N√∫t xem chi ti·∫øt -->
					<!--	<a th:href="@{/customer/order/{maDonHang}(maDonHang=${order.maDonHang})}" style="background-color: #007bff; color: white; padding: 8px 12px; border-radius: 5px; 
                  text-decoration: none; transition: 0.3s; font-size: 14px;">
						Xem Chi Ti·∫øt
					</a>
					<div th:if="${order.trangThaiDonHang == 'ƒê√£ ho√†n th√†nh' and !order.daKhachXacNhan}">
						<form th:action="@{/customer/order/confirm-delivery}" method="post"
							onsubmit="return confirm('üéâ C·∫£m ∆°n b·∫°n ƒë√£ x√°c nh·∫≠n ƒë√£ nh·∫≠n h√†ng!');"
							style="display:inline;">
							<input type="hidden" name="maDonHang" th:value="${order.maDonHang}" />
							<button type="submit" style="background-color: #28a745; color: white; padding: 8px 12px; border-radius: 5px;
			   border: none; text-decoration: none; transition: 0.3s; font-size: 14px; cursor: pointer;">
								‚úÖ ƒê√£ nh·∫≠n h√†ng
							</button>
						</form>


						<form th:action="@{/customer/order/report-not-received}" method="post"
							style="display:inline; margin-left: 10px;">
							<input type="hidden" name="maDonHang" th:value="${order.maDonHang}" />
							<button type="submit" class="btn btn-warning">‚ùó T√¥i ch∆∞a nh·∫≠n ƒë∆∞·ª£c h√†ng</button>
						</form>
					</div>-->

					<!-- N·∫øu ƒë√£ h·∫øt h·∫°n x√°c nh·∫≠n -->
					<div
						th:if="${order.trangThaiDonHang == 'ƒê√£ ho√†n th√†nh' and !order.daKhachXacNhan and order.thoiGianXacNhanKhach != null and #dates.daysBetween(order.thoiGianXacNhanKhach, T(java.time.LocalDateTime).now()) > 14}">
						<p style="color: #dc3545;">‚è∞ ƒê√£ h·∫øt th·ªùi gian x√°c nh·∫≠n (14 ng√†y)</p>
					</div>

					<!-- N·∫øu kh√°ch ƒë√£ x√°c nh·∫≠n -->
					<div th:if="${order.trangThaiDonHang == 'ƒê√£ ho√†n th√†nh' and order.daKhachXacNhan}">
						<p style="color: #28a745; font-weight: bold;">‚úîÔ∏è B·∫°n ƒë√£ x√°c nh·∫≠n ƒë√£ nh·∫≠n h√†ng</p>
					</div>



					<!-- N√∫t H·ªßy ƒë∆°n h√†ng (Ch·ªâ hi·ªÉn th·ªã khi tr·∫°ng th√°i l√† 'ƒêang x·ª≠ l√Ω') -->
					<form id="cancelForm" th:action="@{/customer/order/cancel}" method="POST"
						onsubmit="return validateCancelReason();" th:if="${order.trangThaiDonHang == 'ƒêang x·ª≠ l√Ω'}"
						style="display: inline;">
						<input type="hidden" name="maDonHang" th:value="${order.maDonHang}" />
						<!-- Dropdown ch·ªçn l√Ω do h·ªßy -->

						<button id="cancelButton" type="button" style="background-color: #dc3545; color: white; padding: 8px 12px; border-radius: 5px; 
                    border: none; cursor: pointer; transition: 0.3s; font-size: 14px;"
							onmouseover="this.style.backgroundColor='#c82333'"
							onmouseout="this.style.backgroundColor='#dc3545'"
							onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n h√†ng n√†y kh√¥ng?');">
							H·ªßy ƒê∆°n H√†ng
						</button>
						<!-- N√∫t X√°c nh·∫≠n H·ªßy (·∫®n l√∫c ƒë·∫ßu) -->
						<button type="submit" id="confirmCancelButton" style="display: none; background-color: #dc3545; color: white; padding: 8px 12px; border-radius: 5px; 
     				   border: none; cursor: pointer; transition: 0.3s; font-size: 14px;"
							onclick="return validateCancelReason();">
							X√°c nh·∫≠n h·ªßy
						</button>
						<select id="cancelReasonDropdown" name="lyDoHuy"
							style="padding: 6px; border-radius: 5px; margin-right: 10px; border: 1px solid #ccc;">
							<option value="">-- Ch·ªçn l√Ω do h·ªßy --</option>
							<option value="ƒê·ªïi √Ω, kh√¥ng mu·ªën mua n·ªØa">ƒê·ªïi √Ω, kh√¥ng mu·ªën mua n·ªØa</option>
							<option value="Mu·ªën thay ƒë·ªïi s·∫£n ph·∫©m kh√°c">Mu·ªën thay ƒë·ªïi s·∫£n ph·∫©m kh√°c</option>
							<option value="Th·ªùi gian giao h√†ng qu√° l√¢u">Th·ªùi gian giao h√†ng qu√° l√¢u</option>
							<option value="Ph√≠ v·∫≠n chuy·ªÉn qu√° cao">Ph√≠ v·∫≠n chuy·ªÉn qu√° cao</option>
							<option value="L√Ω do kh√°c">L√Ω do kh√°c</option>
						</select>
					</form>


					<script>
						document.getElementById("cancelButton").addEventListener("click", function () {
							let reasonDropdown = document.getElementById("cancelReasonDropdown");
							let confirmButton = document.getElementById("confirmCancelButton");

							reasonDropdown.style.display = "inline-block"; // Hi·ªán dropdown
							confirmButton.style.display = "inline-block"; // Hi·ªán n√∫t x√°c nh·∫≠n h·ªßy
							this.style.display = "none"; // ·∫®n n√∫t H·ªßy ƒê∆°n H√†ng ban ƒë·∫ßu
						});

						function validateCancelReason() {
							let reason = document.getElementById("cancelReasonDropdown").value;
							if (reason === "") {
								alert("Vui l√≤ng ch·ªçn l√Ω do h·ªßy ƒë∆°n h√†ng.");
								return false;
							}
							return confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n h√†ng n√†y kh√¥ng?");
						}
					</script>
					<!-- üîπ Nh√≥m n√∫t n·∫±m ·ªü g√≥c ph·∫£i ph√≠a tr√™n -->
					<div style="position: absolute; top: 20px; right: 20px; display: flex; gap: 10px;">
						<!-- N√∫t xem chi ti·∫øt -->
						<a th:href="@{/customer/order/{maDonHang}(maDonHang=${order.maDonHang})}" style="background-color: #007bff; color: white; padding: 8px 12px; border-radius: 5px;
			  text-decoration: none; transition: 0.3s; font-size: 14px;">
							Xem Chi Ti·∫øt
						</a>

						<!-- N√∫t x√°c nh·∫≠n kh√°ch ƒë√£ nh·∫≠n h√†ng -->
						<form th:if="${order.trangThaiDonHang == 'ƒê√£ ho√†n th√†nh' and !order.daKhachXacNhan}"
							th:action="@{/customer/order/confirm-delivery}" method="post"
							onsubmit="return confirm('üéâ C·∫£m ∆°n b·∫°n ƒë√£ x√°c nh·∫≠n ƒë√£ nh·∫≠n h√†ng!');"
							style="display:inline;">
							<input type="hidden" name="maDonHang" th:value="${order.maDonHang}" />
							<button type="submit" style="background-color: #28a745; color: white; padding: 8px 12px; border-radius: 5px;
			   border: none; text-decoration: none; transition: 0.3s; font-size: 14px; cursor: pointer;">
								‚úÖ ƒê√£ nh·∫≠n h√†ng
							</button>
						</form>
					</div>

				</div>
			</div>

		</div>





		<!-- Ph√¢n trang -->
		<!-- Ph√¢n trang -->
		<div class="pagination" style="text-align: center; margin-top: 20px;">
			<ul style="display: inline-flex; list-style: none; padding: 0;">
				<!-- N√∫t Previous -->
				<li th:if="${currentPage > 0}">
					<a th:href="@{/customer/order(page=${currentPage - 1}, size=${size}, status=${selectedStatus}, type=${selectedType})}"
						style="padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; 
                      color: #333; background-color: white; margin: 0 5px;">
						‚ùÆ Tr∆∞·ªõc
					</a>
				</li>

				<!-- S·ªë trang -->
				<li th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
					<a th:href="@{/customer/order(page=${i}, size=${size}, status=${selectedStatus}, type=${selectedType})}"
						th:style="${i == currentPage} ? 
                'padding: 6px 10px; border: 1px solid #007bff; border-radius: 4px; text-decoration: none; 
                 color: white; background-color: #007bff; font-weight: bold; margin: 0 5px;' :
                'padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; 
                 color: #333; background-color: white; margin: 0 5px;'" th:text="${i + 1}">
					</a>
				</li>

				<!-- N√∫t Next -->
				<li th:if="${currentPage < totalPages - 1}">
					<a th:href="@{/customer/order(page=${currentPage + 1}, size=${size}, status=${selectedStatus}, type=${selectedType})}"
						style="padding: 6px 10px; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; 
                      color: #333; background-color: white; margin: 0 5px;">
						Sau ‚ùØ
					</a>
				</li>
			</ul>
		</div>



	</main>

	<footer th:replace="customer/fragments/footer :: footer"></footer>

	<style>
		.order-tabs {
			display: flex;
			border-bottom: 2px solid #eee;
			padding-bottom: 10px;
			margin-bottom: 20px;
		}

		.order-tab {
			text-decoration: none;
			color: #333;
			margin-right: 20px;
			font-weight: bold;
			cursor: pointer;
		}

		.order-tab:hover,
		.order-tab.active-tab {
			color: #ff6600;
			font-weight: bold;
		}

		.order-card {
			background-color: #fff;
			border-radius: 10px;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			padding: 15px;
			margin-bottom: 15px;
		}

		.order-actions {
			display: flex;
			gap: 10px;
		}

		.btn-view {
			background-color: #007bff;
			color: white;
			padding: 8px 12px;
			border-radius: 5px;
			text-decoration: none;
		}

		.btn-cancel {
			background-color: #dc3545;
			color: white;
			padding: 8px 12px;
			border-radius: 5px;
			border: none;
			cursor: pointer;
		}

		.pagination {
			text-align: center;
			margin-top: 20px;
		}

		.page-link {
			text-decoration: none;
			padding: 6px 10px;
			border: 1px solid #ccc;
			color: #333;
			border-radius: 4px;
			font-size: 16px;
			margin: 0 5px;
		}

		.active-page {
			background-color: #007bff;
			color: white;
			border: 1px solid #007bff;
		}

		.no-orders {
			text-align: center;
			margin-top: 50px;
		}

		.continue-shopping {
			display: inline-block;
			background-color: #007bff;
			color: white;
			padding: 10px 20px;
			border-radius: 20px;
			text-decoration: none;
		}
	</style>
	<!--import ƒë·ªÉ d√πng avatar-->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>