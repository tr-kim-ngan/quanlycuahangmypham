<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="customer/fragments/head :: head"></head>

<body>
	<header th:replace="customer/fragments/header :: header"></header>

	<main class="container my-4" style="padding-top: 170px;">
		<!-- ƒê∆∞·ªùng d·∫´n ƒëi·ªÅu h∆∞·ªõng -->
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="/index" style="font-weight: bold; color: #007bff;">Trang ch·ªß</a>
				</li>
				<li class="breadcrumb-item active" aria-current="page" style="color: #000;">Gi·ªè h√†ng</li>
			</ol>
		</nav>

		<!-- Ti√™u ƒë·ªÅ -->
		<h3 class="my-4 fw-bold" style="color: #000;">Gi·ªè h√†ng (<span th:text="${cartItems.size()}"></span> s·∫£n ph·∫©m)
		</h3>

		<!-- Ki·ªÉm tra gi·ªè h√†ng c√≥ s·∫£n ph·∫©m kh√¥ng -->
		<div th:if="${cartItems.size() > 0}">
			<div class="row">
				<!-- Danh s√°ch s·∫£n ph·∫©m -->
				<div class="col-md-8">
					<table class="table table-borderless align-middle">
						<thead>
							<tr style="background: #f8f9fa;">
								<th scope="col" style="color: #333; font-weight: bold;">S·∫£n ph·∫©m</th>
								<th scope="col" class="text-center" style="color: #333; font-weight: bold;">Gi√° ti·ªÅn
								</th>
								<th scope="col" class="text-center" style="color: #333; font-weight: bold;">S·ªë l∆∞·ª£ng
								</th>
								<th scope="col" class="text-center" style="color: #333; font-weight: bold;">Th√†nh ti·ªÅn
								</th>
							</tr>
							<tr>
								<td colspan="4">
									<hr style="border-top: 3px solid #000; margin: 0;">
								</td>
							</tr>


						</thead>

						<tbody>
							<tr th:each="item : ${cartItems}" style="border-bottom: 1px solid #ddd;">
								<!-- H√¨nh ·∫£nh s·∫£n ph·∫©m -->
								<td class="d-flex align-items-center">
									<a th:href="@{'/product/' + ${item.sanPham.maSanPham}}" class="me-3">
										<img th:src="@{'/upload/' + ${item.sanPham.hinhAnh}}" class="img-thumbnail"
											style="width: 80px; height: 80px; object-fit: cover; border: 1px solid #ddd;">
									</a>
									<div>
										<h6 class="fw-bold" style="color: #000;" th:text="${item.sanPham.tenSanPham}">
										</h6>

										<form th:action="@{/customer/cart/remove}" method="POST"
											style="display: inline;">
											<input type="hidden" name="sanPhamId" th:value="${item.sanPham.maSanPham}">
											<button type="submit" class="fw-bold border-0 bg-transparent"
												style="cursor: pointer; color: #d70000; font-size: 16px; text-shadow: 0px 0px 1px rgba(0, 0, 0, 0.3);">
												‚ùå X√≥a
											</button>
										</form>
									</div>
								</td>

								<!-- Gi√° ti·ªÅn -->
								<td class="text-center">
									<span class="fw-bold" style="color: #d70000; font-size: 14px;"
										th:text="${sanPhamGiaSauGiamMap[item.sanPham.maSanPham] != null ? 
        #numbers.formatDecimal(sanPhamGiaSauGiamMap[item.sanPham.maSanPham], 0, 'COMMA', 0, 'POINT') + ' ƒë' : 'ƒêang c·∫≠p nh·∫≠t'}">
									</span>
									<br>
									<del class="fw-bold" style="color: #000; font-size: 14px;"
										th:if="${sanPhamKhuyenMaiMap[item.sanPham.maSanPham] != null}"
										th:text="${#numbers.formatDecimal(item.sanPham.donGiaBan, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">
									</del>
								</td>


								<!-- S·ªë l∆∞·ª£ng -->
								<td class="text-center">
									<form th:action="@{/customer/cart/update-quantity}" method="POST"
										class="d-flex align-items-center">
										<input type="hidden" name="sanPhamId" th:value="${item.sanPham.maSanPham}">
										<input type="number" name="quantity" th:value="${item.soLuong}" min="1"
											th:max="${sanPhamSoLuongTonKhoMap[item.sanPham.maSanPham]}"
											class="form-control text-center me-2"
											style="width: 60px; display: inline-block; border: 2px solid #000; ">

										<button type="submit" class="btn btn-info fw-bold"
											style="background-color: #000; color: white; padding: 1px 2px; font-size: 13.5px;">
											T√≠nh ti·ªÅn
										</button>
									</form>
								</td>


								<!-- Th√†nh ti·ªÅn -->
								<td class="text-center fw-bold" style="color: #000; font-size: 14px;">
									<span th:text="${sanPhamGiaSauGiamMap[item.sanPham.maSanPham] != null ? 
        #numbers.formatDecimal(item.soLuong * sanPhamGiaSauGiamMap[item.sanPham.maSanPham], 0, 'COMMA', 0, 'POINT') + ' ƒë' 
        : 'ƒêang c·∫≠p nh·∫≠t'}">
									</span>
								</td>

							</tr>
						</tbody>
					</table>

					<!-- Ti·∫øp t·ª•c mua h√†ng -->
					<a href="/index" class="fw-bold"
						style="color: #28a745; text-decoration: none; transition: color 0.3s ease-in-out;"
						onmouseover="this.style.color='#1e7e34'" onmouseout="this.style.color='#28a745'">
						‚Üê Ti·∫øp t·ª•c mua h√†ng
					</a>
				</div>

				<!-- H√≥a ƒë∆°n t√≥m t·∫Øt -->
				<div class="col-md-4">
					<div class="border p-3 rounded shadow-sm" style="background: #fff; border: #000;">
						<h5 class="fw-bold" style="color: #000;">üßæ H√≥a ƒë∆°n c·ªßa b·∫°n</h5>
						<hr style="border-top: 3px solid #000; margin: 0;">

						<p class="d-flex justify-content-between">
							<span style="color: #333;">T·∫°m t√≠nh:</span>
							<span class="fw-bold" style="color: #000;"
								th:text="${totalPrice != null ? #numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT') + ' ƒë' : 'ƒêang c·∫≠p nh·∫≠t'}">
							</span>
						</p>

						<p class="d-flex justify-content-between">
							<span style="color: #333;">Gi·∫£m gi√°:</span>
							<span style="color: #000;"
								th:text="${discount != null ? '-' + discount : '- 0'} + ' ƒë'"></span>
						</p>
						<hr>
						<h4 class="fw-bold text-danger d-flex justify-content-between">
							<span style="color: #000;">T·ªïng c·ªông:</span>
							<span style="color: #ff6600;"
								th:text="${totalPrice != null ? #numbers.formatDecimal((discount != null ? totalPrice - discount : totalPrice), 0, 'COMMA', 0, 'POINT') + ' ƒë' : 'ƒêang c·∫≠p nh·∫≠t'}">
							</span>
						</h4>

						<p class="text-muted small" style="color: #000;">(ƒê√£ bao g·ªìm VAT)</p>

						<!-- N√∫t thanh to√°n -->
						<form th:action="@{/customer/cart/checkout}" method="POST">
							<button type="submit" class="btn btn-warning w-100 fw-bold"
								style="background: #ff6600; border: none; font-size: 18px; color: #f8f9fa;">Ti·∫øn h√†nh
								ƒë·∫∑t
								h√†ng</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- Hi·ªÉn th·ªã n·∫øu gi·ªè h√†ng tr·ªëng -->
		<div th:if="${cartItems.size() == 0}" class="text-center py-5">
			<h5 class="text-muted fw-bold" style="color: #000;">üõí Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng!</h5>
			<a href="/index" class="btn btn-outline-primary mt-3 fw-bold">Quay l·∫°i mua s·∫Øm</a>
		</div>
	</main>

	<footer th:replace="customer/fragments/footer :: footer"></footer>

	<!-- JavaScript c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng gi·ªè h√†ng -->
	<script>
		function updateCartIconCount() {
			fetch('/customer/cart/total-items')
				.then(response => response.json())
				.then(totalItems => {
					const cartCountElement = document.getElementById('cart-count');
					if (cartCountElement) {
						cartCountElement.textContent = totalItems;
					}
				})
				.catch(error => console.error("L·ªói khi c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng gi·ªè h√†ng: ", error));
		}
		document.addEventListener("DOMContentLoaded", function () {
			updateCartIconCount();
		});
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>